<div id="doc" class="markdown-body container-fluid comment-inner comment-enabled" data-hard-breaks="true"><h1 id="LinuxUbuntu-1804相關設定流程" data-id="LinuxUbuntu-1804相關設定流程"><span>Linux(Ubuntu 18.04)相關設定流程</span></h1><p><span>2020/09/02</span><br>
<span>蘇彥庭</span></p><h3 id="1-Putty安裝方式" data-id="1-Putty安裝方式"><span>1. Putty安裝方式</span></h3><p><a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" target="_blank" rel="noopener"><span>下載頁面連結位置</span></a></p><p><img src="https://i.imgur.com/tWZ743O.png" alt=""></p><p><span>下載後點選putty.exe檔案即可進入連線畫面</span></p><p><img src="https://i.imgur.com/6PIgJsA.png" alt=""></p><h3 id="2-切換終端機命令列為英文" data-id="2-切換終端機命令列為英文"><span>2. 切換終端機命令列為英文</span></h3><p><span>將終端機命列列系統訊息由中文切為英文，因為這樣在處理Bug時會有比較多的資源可以參考。</span></p><p><span>直接在圖形化介面進行修正，搜尋Settings -&gt; Region &amp; Language</span></p><p><span>修改 Language 和 Formats選項，之後重新登入即可轉為英文環境</span></p><h3 id="3-SSH套件相關設定" data-id="3-SSH套件相關設定"><span>3. SSH套件相關設定</span></h3><p><span>開機時自動啟動SSH</span></p><pre><code class="linux hljs">sudo systemctl <span class="hljs-built_in">enable</span> ssh
</code></pre><p><span>為確保資安，將SSH的Port由22改為[新的Port號碼]</span><br>
<span>主要是修改sshd_config文件，將裡面的Port由22改為[新的Port號碼]</span></p><pre><code class="linux hljs"><span class="hljs-attribute">sudo</span> vi /etc/ssh/sshd_config
</code></pre><p><span>相關改法可看</span><a href="https://coder.tw/?p=5020" target="_blank" rel="noopener"><span>參考頁面</span></a></p><p><span>防火牆記得設定允許Port [新的Port號碼] 連入</span></p><pre><code class="linux hljs"><span class="hljs-selector-tag">sudo</span> <span class="hljs-selector-tag">ufw</span> <span class="hljs-selector-tag">allow</span> <span class="hljs-selector-attr">[新的Port號碼]</span>
</code></pre><p><span>另外為了資安設定，可以針對SHH Port加入IP白名單</span><br>
<span>寫法可參考</span><a href="https://noob.tw/ufw/" target="_blank" rel="noopener"><span>頁面連結</span></a><br>
<span>如果有需要設定IP範圍，會用到網路遮罩寫法，對應的寫法可參考</span><a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing#IPv4_CIDR_blocks" target="_blank" rel="noopener"><span>Wiki頁面說明</span></a></p><h3 id="4-安裝R" data-id="4-安裝R"><span>4. 安裝R</span></h3><p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-r-on-ubuntu-18-04" target="_blank" rel="noopener"><span>指令參考頁面</span></a></p><pre><code class="linux hljs">sudo <span class="hljs-keyword">add</span><span class="bash">-apt-repository <span class="hljs-string">'deb https://cloud.r-project.org/bin/linux/ubuntu bionic-cran40/'</span>
</span>sudo apt update
sudo apt install r-base
</code></pre><p><span>安裝好後在命令列直接輸入</span><code>R</code><span>即可進入R環境</span></p><pre><code class="linux hljs"><span class="hljs-attribute">R</span>
</code></pre><h3 id="5-安裝RStudio-Server" data-id="5-安裝RStudio-Server"><span>5. 安裝RStudio Server</span></h3><p><a href="https://rstudio.com/products/rstudio/download-server/debian-ubuntu/" target="_blank" rel="noopener"><span>指令參考頁面</span></a></p><pre><code class="linux hljs">sudo apt-get <span class="hljs-keyword">install</span> gdebi-core
wget https://download2.rstudio.org/<span class="hljs-keyword">server</span>/bionic/amd64/rstudio-<span class="hljs-keyword">server</span><span class="hljs-number">-1.3</span><span class="hljs-number">.1073</span>-amd64.deb
sudo gdebi rstudio-<span class="hljs-keyword">server</span><span class="hljs-number">-1.3</span><span class="hljs-number">.1073</span>-amd64.deb
</code></pre><p><span>防火牆設定允許Port 8787 連入</span></p><pre><code class="linux hljs"><span class="hljs-attribute">sudo</span> ufw allow <span class="hljs-number">8787</span>
</code></pre><p><span>設定開機時自動啟動RStudio Server</span></p><pre><code class="linux hljs">sudo systemctl <span class="hljs-built_in">enable</span> rstudio-server
</code></pre><h3 id="6-Rstudio-Server維護相關指令" data-id="6-Rstudio-Server維護相關指令"><span>6. Rstudio Server維護相關指令</span></h3><p><span>請參考</span><a href="https://support.rstudio.com/hc/en-us/articles/200532327-Managing-the-Server" target="_blank" rel="noopener"><span>頁面連結</span></a></p><h3 id="7-建立使用者" data-id="7-建立使用者"><span>7. 建立使用者</span></h3><pre><code class="linux hljs"><span class="hljs-selector-tag">sudo</span> <span class="hljs-selector-tag">adduser</span> <span class="hljs-selector-attr">[使用者名稱]</span>
</code></pre><p><span>若要改變密碼，先以SSH登入該使用者，之後輸入</span><code>passwd</code><span>，依照系統提示進行密碼修改</span></p><pre><code class="linux hljs"><span class="hljs-attribute">passwd</span>
</code></pre><h3 id="8-安裝Linux套件" data-id="8-安裝Linux套件"><span>8. 安裝Linux套件</span></h3><p><span>依據R套件需求，安裝Linux相關套件</span></p><pre><code class="linux hljs">sudo apt <span class="hljs-keyword">install</span> libssl-dev
sudo apt <span class="hljs-keyword">install</span> libxml2-dev
sudo apt <span class="hljs-keyword">install</span> libcurl4-openssl-dev
</code></pre><h3 id="9-重開機指令" data-id="9-重開機指令"><span>9. 重開機指令</span></h3><pre><code class="linux hljs"><span class="hljs-attribute">sudo</span> systemctl reboot
</code></pre><h3 id="10-安裝NVIDIA顯卡驅動、CUDA、CuDNN配合Tensorflow需求" data-id="10-安裝NVIDIA顯卡驅動、CUDA、CuDNN配合Tensorflow需求"><span>10. 安裝NVIDIA顯卡驅動、CUDA、CuDNN(配合Tensorflow需求)</span></h3><p><span>由於Tensorflow套件會隨時更新其硬體需求條件，所以必須要先至官網確認其硬體環境要求。</span><a href="https://www.tensorflow.org/install/gpu?hl=zh-tw" target="_blank" rel="noopener"><span>點此連結</span></a></p><p><img src="https://i.imgur.com/gz94JPA.png" alt=""></p><p><span>官網有提供Ubuntu18.04版本的安裝指令，但實測發現裝CUDA10.1時會出問題。</span><br>
<span>經過查詢發現NVIDIA驅動必須要裝450版本才不會出問題(官網的程式碼是裝430版本)。</span></p><p><span>目前Tensorflow在Github的</span><a href="https://github.com/tensorflow/docs/blob/master/site/en/install/gpu.md" target="_blank" rel="noopener"><span>安裝指引</span></a><span>上已更新NVIDIA驅動要裝450版本，但官網沒有。</span></p><p><span>首先安裝NVIDIA顯示卡驅動450版本，參考此頁面(</span><a href="https://medium.com/@jackfrisht/install-nvidia-driver-via-ppa-in-ubuntu-18-04-fc9a8c4658b9" target="_blank" rel="noopener"><span>https://medium.com/@jackfrisht/install-nvidia-driver-via-ppa-in-ubuntu-18-04-fc9a8c4658b9</span></a><span>)</span></p><pre><code class="linux hljs"><span class="hljs-meta">#</span><span class="bash"> 新增PPA套件庫</span>
sudo add-apt-repository ppa:graphics-drivers/ppa
sudo apt update
sudo apt install ubuntu-drivers-common
<span class="hljs-meta">
#</span><span class="bash"> 查看可安裝的版本</span>
ubuntu-drivers devices
<span class="hljs-meta">
#</span><span class="bash"> 安裝NVIDA驅動450版本</span>
sudo apt install nvidia-driver-450 
<span class="hljs-meta">
#</span><span class="bash"> 重新啟動</span>
sudo reboot
</code></pre><p><span>輸入顯卡查詢指令判斷是否有正常運作，經查詢後確定GPU有成功抓到。</span></p><pre><code class="linux hljs">nvidia-smi
</code></pre><p><span>成功畫面如下:</span></p><p><img src="https://i.imgur.com/9ErTXHe.png" alt=""></p><p><span>接下來安裝Cuda10.1及CuDnn7.6.5</span></p><pre><code class="linux hljs"><span class="hljs-comment"># Install development and runtime libraries (~4GB)</span>
<span class="hljs-attribute">sudo</span> apt-get install --<span class="hljs-literal">no</span>-install-recommends \
    cuda-<span class="hljs-number">10</span>-<span class="hljs-number">1</span> \
    libcudnn7=<span class="hljs-number">7.6.5.32</span>-<span class="hljs-number">1</span>+cuda10.<span class="hljs-number">1</span>  \
    libcudnn7-dev=<span class="hljs-number">7.6.5.32</span>-<span class="hljs-number">1</span>+cuda10.<span class="hljs-number">1</span>
    
<span class="hljs-comment"># 重新開機</span>
sudo reboot
</code></pre><p><span>安裝好後，需要在環境變數中加入CUDA路徑:</span></p><pre><code class="linux hljs"><span class="hljs-comment"># 打開.bashrc檔案</span>
sudo nano ~/.bashrc

<span class="hljs-comment"># 將下列兩行貼到.bashrc文件最後面並儲存然後退出</span>
<span class="hljs-built_in">export</span> PATH=/usr/<span class="hljs-built_in">local</span>/cuda/bin:<span class="hljs-variable">$PATH</span>
<span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/usr/<span class="hljs-built_in">local</span>/cuda/64:<span class="hljs-variable">$LD_LIBRARY_PATH</span>

<span class="hljs-comment"># 更新.bashrc檔案</span>
<span class="hljs-built_in">source</span> ~/.bashrc

<span class="hljs-comment"># 查詢CUDA版本</span>
nvcc -V
</code></pre><p><span>成功畫面如下:</span><br>
<img src="https://i.imgur.com/y5pwyVB.png" alt=""></p><p><span>接下來再安裝Tensor RT:</span></p><pre><code class="linux hljs">sudo apt-get <span class="hljs-keyword">install</span> -y <span class="hljs-comment">--no-install-recommends libnvinfer6=6.0.1-1+cuda10.1 \</span>
    libnvinfer-dev=<span class="hljs-number">6.0</span><span class="hljs-number">.1</span><span class="hljs-number">-1</span>+cuda10<span class="hljs-number">.1</span> \
    libnvinfer-plugin6=<span class="hljs-number">6.0</span><span class="hljs-number">.1</span><span class="hljs-number">-1</span>+cuda10<span class="hljs-number">.1</span>
</code></pre><p><span>執行後若沒錯誤即安裝完成。</span></p><hr><p><span>此區域尚未設定完成，需要確認該電腦是否有裝SLI橋接器才能進行。</span></p><pre><code class="linux hljs">若有兩張顯卡要進行<span class="hljs-type">SLI</span>串接，則執行以下指令:
<span class="hljs-title">sudo</span> nvidia-xconfig
<span class="hljs-title">sudo</span> nvidia-xconfig <span class="hljs-comment">--multigpu=on</span>
<span class="hljs-title">sudo</span> nvidia-xconfig <span class="hljs-comment">--sli=On</span>
</code></pre><hr><h4 id="補充說明-顯示卡安裝過程可能發生gcc版本不一致，解決方法如下" data-id="補充說明-顯示卡安裝過程可能發生gcc版本不一致，解決方法如下"><span>補充說明: 顯示卡安裝過程可能發生gcc版本不一致，解決方法如下:</span></h4><p><span>首先查詢gcc版本指令</span></p><pre><code class="linux hljs"><span class="hljs-title">gcc</span> <span class="hljs-comment">--version</span>
</code></pre><p><span>CUDA10.1對應的gcc版本為7，若版本不一致則安裝gcc7版，並調整gcc7版優先權</span></p><p><a href="https://archerfmy.github.io/2017/04/12/How-to-switch-your-gcc-g-version-in-ubuntu/" target="_blank" rel="noopener"><span>參考頁面</span></a></p><pre><code class="linux hljs"><span class="hljs-comment"># 安裝gcc-7</span>
sudo apt-get install gcc<span class="hljs-number">-7</span> g++<span class="hljs-number">-7</span>

<span class="hljs-comment"># 修改優先權限(此處系統有gcc9和gcc7版本 設定將gcc7版本優先權高於gcc9版本)</span>
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc<span class="hljs-number">-7</span> <span class="hljs-number">50</span>
sudo update-alternatives --install <span class="hljs-regexp">/usr/bin/g</span>++ g++ <span class="hljs-regexp">/usr/bin/g</span>++<span class="hljs-number">-7</span> <span class="hljs-number">50</span>
sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc<span class="hljs-number">-9</span> <span class="hljs-number">40</span>
sudo update-alternatives --install <span class="hljs-regexp">/usr/bin/g</span>++ g++ <span class="hljs-regexp">/usr/bin/g</span>++<span class="hljs-number">-9</span> <span class="hljs-number">40</span>

<span class="hljs-comment"># 確認是否為gcc7版</span>
gcc --version
</code></pre><p><span>之後重新執行CUDA安裝即可。</span></p><h3 id="11-安裝Anaconda" data-id="11-安裝Anaconda"><span>11. 安裝Anaconda</span></h3><p><span>至</span><a href="https://www.anaconda.com/products/individual" target="_blank" rel="noopener"><span>Anaconda官網</span></a><span>尋找下載連結</span></p><p><span>安裝流程說明</span><a href="https://medium.com/@maniac.tw/%E5%AE%89%E8%A3%9D-anaconda-tensorflow-2bbc6e220fa4" target="_blank" rel="noopener"><span>參考頁面</span></a></p><pre><code class="linux hljs"><span class="hljs-meta">#</span><span class="bash"> 下載檔案</span>
wget https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh
<span class="hljs-meta">
#</span><span class="bash"> 執行安裝</span>
bash Anaconda3-2020.07-Linux-x86_64.sh
<span class="hljs-meta">
#</span><span class="bash"> 依照系統提示安裝並加入環境變數(PATH)</span>
<span class="hljs-meta">
#</span><span class="bash"> 更新.bashrc檔案</span>
source ~/.bashrc
</code></pre><h3 id="12-安裝Python虛擬環境測試Tensorflow" data-id="12-安裝Python虛擬環境測試Tensorflow"><span>12. 安裝Python虛擬環境測試Tensorflow</span></h3><pre><code class="linux hljs"><span class="hljs-comment"># 建立虛擬環境</span>
conda create --name <span class="hljs-string">"r-reticulate"</span> python=<span class="hljs-number">3.6</span>

<span class="hljs-comment"># 進入虛擬環境</span>
conda activate <span class="hljs-string">"r-reticulate"</span>

<span class="hljs-comment"># 安裝相關套件</span>
<span class="hljs-comment"># 首先升級pip</span>
pip install --upgrade pip

<span class="hljs-comment"># 安裝tensorflow</span>
pip install tensorflow

<span class="hljs-comment"># 安裝keras</span>
pip install keras

<span class="hljs-comment"># 虛擬環境內執行Python</span>
python

<span class="hljs-comment"># 在Python測試tensorflow2.0是否能正常運行</span>
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> os
os.environ[<span class="hljs-string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="hljs-string">'2'</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">'GPU'</span>, tf.test.is_gpu_available())
a = tf.constant(<span class="hljs-number">2.0</span>)
b = tf.constant(<span class="hljs-number">4.0</span>)
<span class="hljs-built_in">print</span>(a + b)
</code></pre><h3 id="13-安裝R-Keras" data-id="13-安裝R-Keras"><span>13. 安裝R Keras</span></h3><p><span>首先打開R Studio Server</span></p><pre><code class="R hljs"><span class="hljs-comment"># 安裝套件</span>
install.packages(<span class="hljs-string">"keras"</span>)
</code></pre><p><span>安裝好後，執行範例程式碼，</span><a href="https://github.com/rstudio/keras/blob/master/vignettes/examples/mnist_mlp.R" target="_blank" rel="noopener"><span>點選此連結</span></a><span>到RStudio的keras套件之Github頁面複製程式碼在R中執行。</span></p><p><span>成功執行的畫面</span><br>
<img src="https://i.imgur.com/nkm8s8G.png" alt=""></p></div>